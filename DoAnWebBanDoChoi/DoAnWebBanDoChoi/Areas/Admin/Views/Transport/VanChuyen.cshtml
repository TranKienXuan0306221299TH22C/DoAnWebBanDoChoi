@model List<DoAnWebBanDoChoi.Models.PhiVanChuyen>

@{
    ViewData["Title"] = "Quản lý phí vận chuyển";
}

<style>
    .css_select_div {
        text-align: center;
        margin-top: 20px;
    }

    .css_select {
        display: inline-table;
        width: 25%;
        padding: 5px;
        margin: 5px 2%;
        border: solid 1px #686868;
        border-radius: 5px;
    }

    .btn-them {
        margin: 10px auto;
        display: block;
    }

    table {
        margin-top: 30px;
    }
</style>
<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <div class="col-12">
            <div class="bg-white rounded shadow p-4 border">

                <h3 class="text-center">Quản lý phí vận chuyển</h3>

                <div class="css_select_div">
                    <select class="css_select" id="tinh" title="Chọn Tỉnh Thành">
                        <option value="0">Tỉnh Thành</option>
                    </select>
                    <select class="css_select" id="quan" title="Chọn Quận Huyện">
                        <option value="0">Quận Huyện</option>
                    </select>
                    <input type="number" class="css_select" id="phiship" placeholder="Phí vận chuyển (vnđ)" />
                    <button class="btn btn-primary btn-them" id="btnThem">Thêm</button>
                </div>

                <table class="table table-bordered text-center">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Tỉnh</th>
                            <th>Huyện</th>
                            <th>Phí Ship</th>
                            <th>Ngày Tạo</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            int stt = 1;
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td>@(stt++)</td>
                                    <td>@item.TenTinh</td>
                                    <td>@item.TenHuyen</td>
                                    <td>@item.PhiShip.ToString("N0") vnđ</td>
                                    <td>@item.NgayTao?.ToString("dd/MM/yyyy")</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr><td colspan="5">Chưa có dữ liệu phí vận chuyển</td></tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            
            $.getJSON('https://esgoo.net/api-tinhthanh/1/0.htm', function (data_tinh) {
                if (data_tinh.error == 0) {
                    $.each(data_tinh.data, function (k, v) {
                        $('#tinh').append(`<option value="${v.full_name}" data-id="${v.id}">${v.full_name}</option>`);
                    });
                }
            });

           
            $('#tinh').change(function () {
                const idTinh = $('#tinh option:selected').data('id');
                $('#quan').html('<option value="0">Quận Huyện</option>');

                $.getJSON('https://esgoo.net/api-tinhthanh/2/' + idTinh + '.htm', function (data_quan) {
                    if (data_quan.error == 0) {
                        $.each(data_quan.data, function (k, v) {
                            $('#quan').append(`<option value="${v.full_name}">${v.full_name}</option>`);
                        });
                    }
                });
            });

            // Sự kiện thêm phí
            $('#btnThem').click(function () {
                const tinh = $('#tinh').val();
                const huyen = $('#quan').val();
                const phi = $('#phiship').val();

                if (tinh === "0" || huyen === "0" || !phi) {
                    alert("Vui lòng chọn tỉnh, huyện và nhập phí ship.");
                    return;
                }

                $.ajax({
                    url: '/Admin/Transport/Them',
                    type: 'POST',
                    data: {
                        TenTinh: tinh,
                        TenHuyen: huyen,
                        PhiShip: phi
                    },
                    success: function () {
                        location.reload();
                    },
                    error: function (xhr) {
                        if (xhr.status === 409) {
                            alert(xhr.responseText);
                        } else {
                            alert("Thêm thất bại!");
                        }
                    }
                });
            });
        });
    </script>
}

