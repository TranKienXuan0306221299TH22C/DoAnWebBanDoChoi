
 @using DoAnWebBanDoChoi.Enums
 @using DoAnWebBanDoChoi.ViewModels
 @model List<ChiTietDonHangBinhLuanVM>
@{
    var donHang = (DonHang)ViewBag.DonHang;
    var stt = 1;
}


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h3>Chi tiết đơn hàng #@donHang.MaDh</h3>
            <p><strong>Ngày đặt:</strong> @donHang.NgayTao.ToString("dd/MM/yyyy")</p>
            <p><strong>Ngày hoàn thành:</strong> @(donHang.NgaySua?.ToString("dd/MM/yyyy") ?? "Chưa hoàn thành")</p>
            <p><strong>Phí Ship:</strong>@(donHang.PhiVanChuyen?.ToString("N0") + " đ" ?? "Free SHip")</p>
            <p><strong>Tông tiền:</strong> @donHang.TongTien.ToString("N0") đ</p>
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Sản phẩm</th>
                        <th>Hình ảnh</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ct in Model)
                    {
                        var thanhTien = ct.SoLuong * ct.DonGia;
                        <tr>
                            <td>@stt</td>
                            <td>@ct.TenSanPham</td>
                            <td>
                                <img src="~/img/product/dochoi/@ct.HinhAnh" style="width:80px;height:80px;object-fit:cover;border-radius:8px;" />
                            </td>
                            <td>@ct.SoLuong</td>
                            <td>@ct.DonGia.ToString("N0") đ</td>
                            <td>@thanhTien.ToString("N0") đ</td>
                            <td>
                                @if ((TrangThaiDonHang)donHang.TrangThai == TrangThaiDonHang.DaGiao)
                                {
                                    if (!ct.DaBinhLuan)
                                    {
                                        <a asp-controller="Comment" asp-action="ThemBinhLuan"
                                           asp-route-maSp="@ct.MaSp"
                                           asp-route-maCtdh="@ct.MaCtdh"
                                           asp-route-maDh="@donHang.MaDh"
                                           class="btn btn-primary btn-sm">Bình luận</a>
                                    }
                                    else
                                    {
                                        <button class="btn btn-secondary btn-sm" disabled>Đã bình luận</button>
                                    }
                                }
                            </td>
                        </tr>
                        stt++;
                    }
                </tbody>
            </table>
            <a asp-controller="Profile" asp-action="DonHang"  class="btn btn-secondary">Quay lại</a>
        </div>
    </div>
</div>
