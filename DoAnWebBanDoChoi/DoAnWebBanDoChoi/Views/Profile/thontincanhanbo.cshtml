@model DoAnWebBanDoChoi.ViewModels.ProfileVM
@using DoAnWebBanDoChoi.Enums


@{
    ViewData["Title"] = "Tài khoản";
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
<div class="container py-4">
    <h3 class="mb-4">Tài khoản của bạn</h3>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="profileTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-content"
                    type="button" role="tab" aria-controls="profile-content" aria-selected="true">
                Hồ sơ
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders-content"
                    type="button" role="tab" aria-controls="orders-content" aria-selected="false">
                Đơn hàng
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#xacnhan-content"
                    type="button" role="tab" aria-controls="orders-content" aria-selected="false">
              Xác nhận
            </button>
        </li>
    </ul>

    <!-- Tab contents -->
    <div class="tab-content" id="profileTabContent">
        <!-- Hồ sơ -->
        <div class="tab-pane fade show active" id="profile-content" role="tabpanel" aria-labelledby="profile-tab">
            <div class="card p-3">
                <h5>Thông tin cá nhân</h5>
                <img src="@Url.Content("~/img/" + Model.HinhAnh)" class="rounded-circle mb-3" width="100" height="100" style="object-fit: cover; border: 2px solid #ccc;">
                <p><strong>Họ tên hiển thị:</strong> @(Model.HoTenHienThi ?? "Chưa cung cấp")</p>
                <p><strong>Email:</strong> @Model.Email</p>
                <p><strong>Số điện thoại:</strong> @(Model.DienThoai ?? "Chưa cung cấp")</p>
                <p><strong>Địa chỉ:</strong> @(Model.DiaChi ?? "Chưa cung cấp")</p>
                <a asp-action="Edit" class="btn btn-warning btn-sm">Chỉnh sửa thông tin</a>
            </div>
        </div>

        <!-- Đơn hàng -->
        <div class="tab-pane fade" id="orders-content" role="tabpanel" aria-labelledby="orders-tab">
            <div class="card p-3">
                <h5>Đơn hàng</h5>
                @if (Model.DonHangs != null && Model.DonHangs.Any())
                {
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Mã Đơn</th>
                                <th>Ngày đặt</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Phương thức</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var dh in Model.DonHangs)
                            {
                                <tr>
                                    <td>@dh.MaDh</td>
                                    <td>@dh.NgayTao.ToString("dd/MM/yyyy")</td>
                                    <td>@dh.TongTien.ToString("N0") ₫</td>
                                    <td>@(((TrangThaiDonHang)dh.TrangThai).GetDisplayName())</td>
                                    <td>@dh.PhuongThucThanhToan</td>
                                    <td>
                                        <a href="/DonHang/ChiTiet/@dh.MaDh" class="btn btn-sm btn-primary">Xem chi tiết</a>
                                        <form asp-action="HuyDonHang" method="post" style="display:inline;">
                                            <input type="hidden" name="id" value="@dh.MaDh" />
                                            <button type="submit"
                                                    class="btn btn-sm btn-danger"
                                            @(dh.TrangThai >= 3 ? "disabled" : "")
                                                    style="opacity: @(dh.TrangThai >= 3 ? "0.6" : "1"); cursor: @(dh.TrangThai >= 3 ? "not-allowed" : "pointer");"
                                                    onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này không?')">
                                                Hủy đơn
                                            </button>
                                        </form>

                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p>Chưa có đơn hàng nào.</p>
                }

               
            </div>
        </div>
      
    </div>
</div>
