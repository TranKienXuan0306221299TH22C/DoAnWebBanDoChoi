
@model DoAnWebBanDoChoi.ViewModels.ProfileVM
@{
    ViewData["Title"] = "Tài khoản";
}

<div class="container py-4">
    <h3 class="mb-4">Tài khoản của bạn</h3>

    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link active" href="#">Thông tin cá nhân</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" asp-action="DonHang">Đơn hàng</a>
        </li>
        
    </ul>

    <div class="card p-4">
        <h5>Thông tin cá nhân</h5>

        <form id="formUploadAvatar" asp-action="DoiAnhDaiDien" asp-controller="Profile" method="post" enctype="multipart/form-data">

            <img id="avatarImage"
                 src="@Url.Content("~/img/profile/" + (Model.HinhAnh ?? "default-avatar.png"))"
                 class="rounded-circle mb-3"
                 width="100"
                 height="100"
                 style="object-fit: cover; border: 2px solid #ccc; cursor: pointer;"
                 title="Nhấn để thay đổi ảnh đại diện">

            <input type="file" id="fileInput" name="HinhAnhFile" accept="image/*" style="display: none;" />

            <button type="submit" id="btnSaveAvatar" class="btn btn-primary btn-sm" style="display: none;">Lưu ảnh mới</button>
            <span id="fileNameDisplay" class="ms-3 text-muted" style="display: none;"></span>
        </form>
        <p><strong>Họ tên hiển thị:</strong> @(Model.HoTenHienThi ?? "Chưa cung cấp")</p>
        <p><strong>Email:</strong> @Model.Email</p>
        <p><strong>Số điện thoại:</strong> @(Model.DienThoai ?? "Chưa cung cấp")</p>
        <p><strong>Địa chỉ:</strong> @(Model.DiaChi ?? "Chưa cung cấp")</p>
        <a asp-action="Edit" class="btn btn-warning btn-sm">Chỉnh sửa thông tin</a>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // 1. Kích hoạt input file khi click vào ảnh
            $('#avatarImage').on('click', function () {
                $('#fileInput').click();
            });

            // 2. Xử lý khi chọn file xong
            $('#fileInput').on('change', function () {
                var file = this.files[0];
                if (file) {
                    // Hiển thị tên file và nút Lưu
                    $('#fileNameDisplay').text('Đã chọn: ' + file.name).show();
                    $('#btnSaveAvatar').show();

                    // Xem trước ảnh (optional)
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        // Cập nhật đường dẫn src của ảnh
                        $('#avatarImage').attr('src', e.target.result);
                    }
                    reader.readAsDataURL(file);

                } else {
                    // Nếu người dùng hủy chọn file
                    // Để ảnh trở lại trạng thái ban đầu sau khi tải lại trang
                    $('#fileNameDisplay').hide();
                    $('#btnSaveAvatar').hide();
                }
            });
        });
    </script>
}